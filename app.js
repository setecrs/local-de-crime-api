
var privateKey = '-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAshDMiFiIRzVRZgzdGJIDxUe+neRNRtGLeSBK1d/OuTpGbzmL\nH4FBMK3lhDAo/L+kZ2VmAzSwGZRZC4jTpapyABdof8tld4Ft48wsFWWjMlbtD9pV\nf2ERRgA4GIjYWMVuXlbtVuPHJs+/Bv/9klQrssLfVgGJE4HawlckbI/J+KC/SIZp\ng3hJZFOMrcSdLDuMWHm6w4q853go10Bhvb3Soga6MGfxO6fV/xVivvXaqHL4ixoU\ncBmQBbjtobJLeR+h0fa0nEkhTRN+Evc/3LXJ9t7rQ5z8tFgO3KeVFG0d6aESzhuP\nECbTW0ZPgt8ztcVu6Xe9Ye8886o0pWUkaUuI9wIDAQABAoIBAQCiKbJbKWVSlDgB\nHA3uZmuQqnnqCRRnPkYqlUIR7LSy82NZv6n3kxrvXi77Z3CsXUs37pwspzsI0JUX\ncBBvev4/HxJH79AEOZb+Md6jzeAF5CwYl9ntG1VDzsdHcLi2f3a366pRyzZ/Hgr2\nMQOY05bIQbhq9xMC9OtouTuusnRZO2VeXOtmmkD0j360v0wZCofIk1yRcSA8o28+\nN39zKIPn2eZWTkDGAFlb1lxPmpNNOsFS2nLtcYjnwKwp/zE4Wav963afaWc8/T1w\nMC0/X0ooCF8kZPrGiL5YvyZZev/ZinwvVRG9rUxdZ5SO4qcXidc54vLbOlVpIHws\nmnijaQthAoGBAOcZ3m8CKJ8aGIdB9VfweeNOTatvuZmVN+Qsq8nnicuFqUxcZQsF\nFKt8pbS3/3FdLbHIwQX8SV5d/WfaxLCHI3R5jxAECaKw6EKlw7C9ZymNqDpTypUg\nycY+qfzMVUUKwyzcH0HzpZmohLNUNY9q0XPbgnx5/V9ZiCpuNR3SofJtAoGBAMVA\nIR3ijNT27maqhvMv48PTYFC1ms/GsnuqKCuzpi1wIo3Kc8vkqZNshyZkeR5EZiNo\npuPnRy9eKAqG1Q6RhA8vXhnvu0nOvujPMgaj3CpfoRF54kup+2ptYNolDX7p+Xq0\nvyqHNV2Le+1OqfWSyRfp76PXXbHfAqMQF7EWROpzAoGAcyvkO6RyxB/IO5g2gjX5\nOLvsX1TVxWGlMhTFJGE8ve4F2mVtgdltXK1JE9BjAIc0X5ayA56gnePvhxNy1Jr0\no3Z1QsEQYEET7ysXZHxv7jiHr1HU8w8dH6xZIQBgOoFLlY66ES8wx2xBffGoo6nT\nao7p78kH6b3/601zMUKorN0CgYBQkjt0y5+fNiZ3hVyOZZdx3BvRm/zatl0dqomy\nIDXXBaD3riTSulqSP5iNFCltNZ9LA2p4WXZ4YMuWUTEiPEpnMYAMtCIaqfrNeiUD\nFVfPbzSJwPGw2oQ6Guee89epacVgXAhiRMyFo35BlwpRp13BCOu8TzKUf3XCScaD\nrYcFBQKBgArZa0jQFLjg5rXbmGSJm80QEtAESxSG8fTfZRy3bgEeM1ZKp9g51TS6\nC1pv9oEvHpJfPGI3is77nlwb1wNed/KS7VJTzFFPqf94PR4kwyQccquusvZASekA\nOHxNMhOeBpegLwYOlU3cTL0RdmNWNR7XE9mOG7RozvuGXwBQpcgT\n-----END RSA PRIVATE KEY-----';
var certificate = '-----BEGIN CERTIFICATE-----\nMIICozCCAYsCBgFnCJOlvjANBgkqhkiG9w0BAQsFADAUMRIwEAYDVQQDDAlsb2Nh\nbGhvc3QwHhcNMTgxMTEyMTUzOTEzWhcNMTkxMTEyMTUzOTEzWjAWMRQwEgYDVQQD\nDAtleGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALIQ\nzIhYiEc1UWYM3RiSA8VHvp3kTUbRi3kgStXfzrk6Rm85ix+BQTCt5YQwKPy/pGdl\nZgM0sBmUWQuI06WqcgAXaH/LZXeBbePMLBVlozJW7Q/aVX9hEUYAOBiI2FjFbl5W\n7VbjxybPvwb//ZJUK7LC31YBiROB2sJXJGyPyfigv0iGaYN4SWRTjK3EnSw7jFh5\nusOKvOd4KNdAYb290qIGujBn8Tun1f8VYr712qhy+IsaFHAZkAW47aGyS3kfodH2\ntJxJIU0TfhL3P9y1yfbe60Oc/LRYDtynlRRtHemhEs4bjxAm01tGT4LfM7XFbul3\nvWHvPPOqNKVlJGlLiPcCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAJlhJMDvD5dBN\nu3neAUIJTpA8vbvYkpeZWNvderXKe6sLGp0KfFMtSdMW9KBaaWBItlMRlxMIvYyg\nCa32b9KCbzCziwVTg+RWckym1mLMioFoUgcZBSPPvN3DdXEnE/rUH34XZvca0Yqz\njsYtPa4carl1R9HsSc1bjpqhxlTWkw32G39lcszQHgI6ILrPBpLmVCgRkyRGpRcK\n7SQDpIblXeG55LWRO+P7h4LtuwkcMlzWEI7z15e4PWD52yC+P2tbcbravHyqSjHv\nSaJOUAeklsgRq3N62JtHoZajSkR3v9W2ENB42GjvLSf07em3fAhHtAnyZCMJvcvm\nqYC7qo905A==\n-----END CERTIFICATE-----';
var certificateAuthority = '-----BEGIN CERTIFICATE-----\nMIICpDCCAYwCCQDXvVZZzXgjEDANBgkqhkiG9w0BAQsFADAUMRIwEAYDVQQDDAls\nb2NhbGhvc3QwHhcNMTgxMTEyMTUzOTEzWhcNMTkxMTEyMTUzOTEzWjAUMRIwEAYD\nVQQDDAlsb2NhbGhvc3QwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC8\nngD6UyL3cgbStWKdtw1VVelkrQayu+MIqo3biOkTdYSHS1l/OBbkjEJW/yOBWLSU\n3+oEuHwfVxL879U2LogjnBHWx5oCRtCdyD4cgHanRhDlrYuQNj48wnZt/P1AzocI\ncuZmu7zboC3Ef7sOAo5IraOCp4FlCpobuHO47lmaC0vu8hkiTzaeewlFSMenZ4np\nyz33X1Oa4wnR21wss+RVDg9RsJv8FJp8U+jyFvdCANE86B2CY0whFKHyVWNrlBS5\n2ySURuSBPE34DhtHs4fmEpoFWYjBtXrGJXb3CU6eAQZX4WncSakiGJ7bIpocqBkg\nIdBkD2Fe+PkK6GbeAfG1AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAHbJ4NEMWgBq\nv9ZCtGoz9teZ34Qfu5PXlstCjjUFAnUFQvXLrwwPgqeV7yqVSfSrr3JOdIUrPBGk\nqLO0MJjY40WB8GBHOB0J3N0nm5/iLFhCv5LoxzC18dTZpMaGk7etqIkVGz/bkYSO\n8puH+WRtekWmuLwnwBIq8bJereZOFU87p5qiU5WqUN3KSmnSvoHTbCSuHvEfmTZw\nBvA8bOE4jldqlk2sTSPyAauliefsSD9eybXPYE3TBf5U1FhML9h7GciPeOEpcpDg\niMdkG1XT3CZCi2uSzuQHJNfex8Mu0tCgwdVh2M8O7ZOsoxgFIktnQSN3JdScw+Nf\nO63QxGOPcQc=\n-----END CERTIFICATE-----';



// set up ======================================================================
// get all the tools we need
var express = require('express');
var app = express();
var port = process.env.PORT || 3009;
var mongoose = require('mongoose');
var flash = require('connect-flash');
var morgan = require('morgan');
var cookieParser = require('cookie-parser');
var session = require('express-session');
var time = require('time')(Date);

var sslConfig = require('ssl-config')('modern');
const createCert = require('create-cert');
var https = require('https');

// variables containing the routes files
var userRouter = require('./routes/users');
var ocorrenciasRouter = require('./routes/ocorrencias');
var dadosGeraisRouter = require('./routes/dados_gerais');
var enderecoRouter = require('./routes/endereco');
var responsavelLocalRouter = require('./routes/responsavel_local');
var sobreLocalRouter = require('./routes/sobre_local');
var sobreFatoRouter = require('./routes/sobre_fato');
var vestigiosRouter = require('./routes/vestigios');
var policiaisAcionadosRouter = require('./routes/policiais_acionados');
var obterListasRouter = require('./routes/obter_listas');
var testemunhasRouter = require('./routes/testemunhas');

// configuration ===============================================================
mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost/policia_federal'); // connect to our database;

// set up our express application
app.use(morgan('dev')); // log every request to the console
app.use(cookieParser()); // read cookies (needed for auth)
app.use(express.json()); // these two get information from html forms
app.use(express.urlencoded({ extended: true }));

// routes ======================================================================
app.use('/', userRouter);
app.use('/ocorrencias', ocorrenciasRouter);
app.use('/dados_gerais', dadosGeraisRouter);
app.use('/endereco', enderecoRouter);
app.use('/responsavel_local', responsavelLocalRouter);
app.use('/sobre_local', sobreLocalRouter);
app.use('/sobre_fato', sobreFatoRouter);
app.use('/vestigios', vestigiosRouter);
app.use('/policiais_acionados', policiaisAcionadosRouter);
app.use('/obter_listas', obterListasRouter);
app.use('/testemunhas', testemunhasRouter);


// launch ======================================================================

//Verificamos se as tebelas ja existem, caso nao, populamos o banco
mongoose.model('Estado').find().exec(function(err,results){
    //Se nao achar os dados
    if(results.length == 0){
        //Popula banco
        const popBanco = require('./routes/popular_banco');
        var popularBanco = new popBanco();
        popularBanco.popularBanco();
    }
});

// SSL 
var server = https.createServer({
	key: privateKey,
	cert: certificate,
	ca: certificateAuthority,
	ciphers: sslConfig.ciphers,
	honorCipherOrder: true,
	secureOptions: sslConfig.minimumTLSVersion
}, app);

server.listen(port)

console.log('Acesse localhost:' + port);